{
    "componentId": "loitering_pipeline",
    "componentType": "node.algorithm.pipeline",
    "parser_version": "Parser/V1",
    "body": {
        "header": {
            "uid": {
                "id": "loitering_camera_100_100",
                "version": "v0.0.1",
                "releaseTag": "stable"
            }
        },
        "spec": {
            "@templateType": "template.vdag.app-layout.sample-vdag:v0.0.1-beta",
            "values": {
                "masterDAG": {
                    "runtimeID": "default-mdag"
                },
                "source": {
                    "assignmentType": "source",
                    "id": "camera_100_100",
                    "settings": {
                        "controller_node": "framequeues-2"
                    },
                    "parameters": {
                        "fps": "5/1",
                        "actuation_frequency": 1,
                        "gpu_id": 1,
                        "use_gpu": true,
                        "allocation_node": "framequeues-2",
                        "mode": "memory",
                        "loop_video": true,
                        "as_live": true,
                        "frame_quality": 90,
                        "color_format": "BGR"
                    }
                },
                "settings": {
                    "alert_url": "http://test-alerts.io",
                    "test": {
                        "x": "hello",
                        "y": "world",
                        "z": [{
                            "a": "hello",
                            "b": "world"
                        }, {
                            "c": "hello",
                            "d": "world"
                        }]
                    },
                    "ALERTIDURL":"http://serverip:alertidpost/getalertid"
                },
                "nodes": [{
                    "spec": {
                        "@templateType": "template.nodes.generic.generic_node:v0.0.1-beta",
                        "values": {
                            "nodeLabel": "obj-det-1",
                            "nodeType": "algorithm",
                            "componentURI": "node.algorithm.objdet.general7Detection_360h_640:v0.0.1-stable",
                            "settings": {
                                    "use_fp16": true,
                                    "use_cuda": true,
                                    "batch_size": 8,
                                    "decoderType": "DALI",
                                    "interpolationType": "INTERP_GAUSSIAN",
                                    "width": 416,
                                    "height": 416,
                                    "FullImage": true,
                                    "enable_batching": true,
                                    "decoder_width": 640,
                                    "decoder_height": 360,
                                    "stretch_image": false,
                                    "blockRoiEnabled": false,
                                    "roiBatchSize": 1
                            },
                            "parameters": {
                                "mjpeg": {
                                    "enabled": false,
                                    "drawingParams": [{"zone":true,"roi":true,"line":false,"arrow":false,"alertHighlight":true,"caliberation":false}]
                                },
                                "alerts": {
                                    "enabled": false
                                },
                                "conf": 0.4,
                                "iou": 0.45,
                                "max_dets": 300
                            },
                            "nodeDescription": "Hello-world!"
                        }
                    },
                    "scaleSpec": {
                        "@templateType": "template.scale.allocation.allocation-sample:v0.0.1-beta",
                        "values": {
                            "clusterID": "registry.k8s.clusters.default-cluster",
                            "machineID": "framequeues-2",
                            "gpuID": 1,
                            "configurations": {
                                "mjpeg": {
                                    "enabled": true,
                                    "componentURI": "node.utils.drawing.drawing:v0.0.1-stable",
                                    "dimensions": {
                                        "width": 1920,
                                        "height": 1080
                                    }
                                },
                                "alerts": {
                                    "enabled": false
                                }
                            }
                        }
                    },
                    "IOMap": [{
                        "inputs": [{
                            "name": "input_0",
                            "reference": "input_0"
                        }],
                        "outputs": [{
                            "name": "output_0",
                            "reference": "output_0"
                        }]
                    }],
                    "extensions": []
                }, {
                    "spec": {
                        "@templateType": "template.nodes.generic.generic_node:v0.0.1-beta",
                        "values": {
                            "nodeLabel": "policy-1",
                            "nodeType": "algorithm",
                            "componentURI": "node.utils.policy.policy:v0.0.1-stable",
                            "settings": {},
                            "parameters": {
                                "mjpeg": {
                                    "enabled": false,
                                    "drawingParams": [{"zone":true,"roi":true,"line":false,"arrow":false,"alertHighlight":true,"caliberation":false}]
                                },
                                "alerts": {
                                    "enabled": false
                                },
                                "policies": {
                                    "filters": [{
                                        "key": "class_conf_filter",
                                        "params": {
                                              "score": 0.5,
                                              "allowed_classes": [
                                                "person"
                                              ]
                                            }
                                    }, {
                                        "key": "inside_zone",
                                        "params": {
                                            "zone": ["ZoneLoitering"],
                                            "pivotPoint": "bottomPoint"
                                        }
                                    }]
                                }
                            },
                            "nodeDescription": "Hello-world!"
                        }
                    },
                    "scaleSpec": {
                        "@templateType": "template.scale.allocation.allocation-sample:v0.0.1-beta",
                        "values": {
                            "clusterID": "registry.k8s.clusters.default-cluster",
                            "machineID": "framequeues-2",
                            "gpuID": 1,
                            "configurations": {
                                "mjpeg": {
                                    "enabled": true,
                                    "componentURI": "node.utils.drawing.drawing:v0.0.1-stable",
                                    "dimensions": {
                                        "width": 1920,
                                        "height": 1080
                                    }
                                },
                                "alerts": {
                                    "enabled": false
                                }
                            }
                        }
                    },
                    "IOMap": [{
                        "inputs": [{
                            "name": "input_0",
                            "reference": "input_0"
                        }],
                        "outputs": [{
                            "name": "output_0",
                            "reference": "output_0"
                        }]
                    }],
                    "extensions": []
                }, {
                    "spec": {
                        "@templateType": "template.nodes.generic.generic_node:v0.0.1-beta",
                        "values": {
                            "nodeLabel": "tracker-1",
                            "nodeType": "algorithm",
                            "componentURI": "node.algorithm.tracker.trackerlite:v0.0.1-stable",
                            "settings": {
                                "ttl": 4,
                                "tracker_type": "NONE",
                                "keep_upper_height_ratio": 1.0,
                                "decoderType": "DALI",
                                "interpolationType": "INTERP_GAUSSIAN",
                                "batch_size": 16,
                                "enable_batching": true
                            },
                            "parameters": {
                                "mjpeg": {
                                    "enabled": false,
                                    "drawingParams": [{"zone":true,"roi":true,"line":true,"arrow":true,"alertHighlight":true,"caliberation":true}]
                                },
                                "alerts": {
                                    "enabled": false
                                },
                                "iou": 0.45,
                                "sigma_iou": 0.3,
                                "sigma_h": 0.3,
                                "sigma_l": 0.1,
                                "t_min": 2
                            },
                            "nodeDescription": "Hello-world!"
                        }
                    },
                    "scaleSpec": {
                        "@templateType": "template.scale.allocation.allocation-sample:v0.0.1-beta",
                        "values": {
                            "clusterID": "registry.k8s.clusters.default-cluster",
                            "machineID": "framequeues-2",
                            "gpuID": 1,
                            "configurations": {
                                "mjpeg": {
                                    "enabled": true,
                                    "componentURI": "node.utils.drawing.drawing:v0.0.1-stable",
                                    "dimensions": {
                                        "width": 1920,
                                        "height": 1080
                                    }
                                },
                                "alerts": {
                                    "enabled": false
                                }
                            }
                        }
                    },
                    "IOMap": [{
                        "inputs": [{
                            "name": "input_0",
                            "reference": "input_0"
                        }],
                        "outputs": [{
                            "name": "output_0",
                            "reference": "output_0"
                        }]
                    }],
                    "extensions": []
                }, {
                    "spec": {
                        "@templateType": "template.nodes.generic.generic_node:v0.0.1-beta",
                        "values": {
                            "nodeLabel": "policy-2",
                            "nodeType": "algorithm",
                            "componentURI": "node.utils.policy.policy:v0.0.1-stable",
                            "settings": {},
                            "parameters": {
                                "mjpeg": {
                                    "enabled": false,
                                    "drawingParams": [{"zone":true,"roi":true,"line":false,"arrow":false,"alertHighlight":true,"caliberation":false}]
                                },
                                "alerts": {
                                    "enabled": false
                                },
                                "policies": {
                                    "filters": [{
                                        "key": "dwell",
                                        "params": {
                                            "loiteringThresholdSeconds": 1
                                        }
                                    }]
                                }
                            },
                            "nodeDescription": "Hello-world!"
                        }
                    },
                    "scaleSpec": {
                        "@templateType": "template.scale.allocation.allocation-sample:v0.0.1-beta",
                        "values": {
                            "clusterID": "registry.k8s.clusters.default-cluster",
                            "machineID": "framequeues-2",
                            "gpuID": 1,
                            "configurations": {
                                "mjpeg": {
                                    "enabled": true,
                                    "componentURI": "node.utils.drawing.drawing:v0.0.1-stable",
                                    "dimensions": {
                                        "width": 1920,
                                        "height": 1080
                                    }
                                },
                                "alerts": {
                                    "enabled": false
                                }
                            }
                        }
                    },
                    "IOMap": [{
                        "inputs": [{
                            "name": "input_0",
                            "reference": "input_0"
                        }],
                        "outputs": [{
                            "name": "output_0",
                            "reference": "output_0"
                        }]
                    }],
                    "extensions": []
                }, {
                    "spec": {
                        "@templateType": "template.nodes.generic.generic_node:v0.0.1-beta",
                        "values": {
                            "nodeLabel": "usecase-1",
                            "nodeType": "algorithm",
                            "componentURI": "node.utils.usecase.usecase:v0.0.1-stable",
                            "settings": {},
                            "parameters": {
                                "mjpeg": {
                                    "enabled": true,
                                    "drawingParams": [{"zone":true,"roi":true,"line":false,"arrow":false,"alertHighlight":true,"caliberation":false}]
                                },
                                "alerts": {
                                    "cl_data": false,
                                    "enabled": true,
                                    "drawingParams": [{"zone":false,"roi":false,"line":false,"arrow":false,"alertHighlight":false,"caliberation":false}],
                                    "storageParams": [{
                                       "MINIO": {
                                            "endpoint": "serverip:32751",
                                            "access_key": "accesskey",
                                            "secret_key": "secret_key",
                                            "MINIOURLREPLACEMENT": ""
                                        }
                                    }],
                                    "dbParams": [{
                                        "MONGO": {
                                            "host": "mongoip",
                                            "dbname": "CITYALERT",
                                            "collection": "alerts"
                                        }
                                    }],
                                    "dataPushParams": [{
                                        "REDIS": {
                                            "host": "serverip",
                                            "port": 6379,
                                            "password": "secret#",
                                            "db": 0
                                        }
                                    }]
                                },
                                "usecase": {
                                    "filters": [{
                                        "key": "loitering",
                                        "params": {
                                            "loiteringThresholdSeconds": 120,
                                            "alert_interval": 600,
                                            "severity": "medium"
                                        }
                                    }]
                                }
                            },
                            "nodeDescription": "Hello-world!"
                        }
                    },
                    "scaleSpec": {
                        "@templateType": "template.scale.allocation.allocation-sample:v0.0.1-beta",
                        "values": {
                            "clusterID": "registry.k8s.clusters.default-cluster",
                            "machineID": "framequeues-2",
                            "gpuID": 1,
                            "configurations": {
                                "mjpeg": {
                                    "enabled": true,
                                    "componentURI": "node.utils.drawing.drawing:v0.0.1-stable",
                                    "dimensions": {
                                        "width": 1920,
                                        "height": 1080
                                    }
                                },
                                "alerts": {
                                    "enabled": true,
                                    "componentURI": "node.utils.alert.alert:v0.0.1-stable",
                                    "dimensions": {
                                        "width": 1920,
                                        "height": 1080
                                    }
                                }
                            }
                        }
                    },
                    "IOMap": [{
                        "inputs": [{
                            "name": "input_0",
                            "reference": "input_0"
                        }],
                        "outputs": [{
                            "name": "output_0",
                            "reference": "output_0"
                        }]
                    }],
                    "extensions": []
                }],
                "graph": {
                    "input": [{
                        "nodeLabel": "obj-det-1",
                        "inputNames": [
                            "input_0"
                        ]
                    }],
                    "output": [{
                        "nodeLabel": "usecase-1",
                        "outputNames": [
                            "output_0"
                        ]
                    }],
                    "connections": [{
                        "nodeLabel": "policy-1",
                        "inputs": [{
                            "nodeLabel": "obj-det-1",
                            "outputNames": [
                                "output_0"
                            ]
                        }]
                    }, {
                        "nodeLabel": "tracker-1",
                        "inputs": [{
                            "nodeLabel": "policy-1",
                            "outputNames": [
                                "output_0"
                            ]
                        }]
                    }, {
                        "nodeLabel": "policy-2",
                        "inputs": [{
                            "nodeLabel": "tracker-1",
                            "outputNames": [
                                "output_0"
                            ]
                        }]
                    }, {
                        "nodeLabel": "usecase-1",
                        "inputs": [{
                            "nodeLabel": "policy-2",
                            "outputNames": [
                                "output_0"
                            ]
                        }]
                    }]
                }
            }
        }
    }
}